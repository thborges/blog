<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.5">Jekyll</generator><link href="http://localhost:4000/blog/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/blog/" rel="alternate" type="text/html" /><updated>2019-01-07T23:07:15-02:00</updated><id>http://localhost:4000/blog/feed.xml</id><title type="html">3D, circuits and coding projects</title><subtitle>Documentation for some profissional and hobbie projects about 3D printers modifications, 3D designs, algorithms, circuits and more. Thank you for reading. Fell free to contact me.</subtitle><entry><title type="html">Reducing Marlin firmware binary size to fit in your 3D printer board memory</title><link href="http://localhost:4000/blog/marlin/2019/01/07/reducing-marlin-binary-size.html" rel="alternate" type="text/html" title="Reducing Marlin firmware binary size to fit in your 3D printer board memory" /><published>2019-01-07T18:44:14-02:00</published><updated>2019-01-07T18:44:14-02:00</updated><id>http://localhost:4000/blog/marlin/2019/01/07/reducing-marlin-binary-size</id><content type="html" xml:base="http://localhost:4000/blog/marlin/2019/01/07/reducing-marlin-binary-size.html">&lt;p&gt;How to reduce the Marlin binary size? Here are my special compilation flags that was able to reduce it by almost 6K.&lt;/p&gt;

&lt;p&gt;Changing them is easy wether you are using Arduino IDE or PlataformIO.&lt;/p&gt;

&lt;p&gt;If already using PlataformIO, it is easier. Just create a new build target in platformio.ini, copying the original config for your printer board and adding the new flags:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ini&quot; data-lang=&quot;ini&quot;&gt;&lt;span class=&quot;py&quot;&gt;build_unflags&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;-g -ggdb&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;build_flags&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;${common.build_flags} -fno-tree-scev-cprop -fno-split-wide-types -Wl,--relax -mcall-prologues&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;In Arduino IDE, you should edit the file platform.local.txt for your board. It is inside the hardware folder, together with your other Arduino project folders, or in the Arduino instalation folder. Search for it.&lt;/p&gt;

&lt;p&gt;Content to add in platform.local.txt:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ini&quot; data-lang=&quot;ini&quot;&gt;&lt;span class=&quot;py&quot;&gt;compiler.c.extra_flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;-fno-tree-scev-cprop -fno-split-wide-types -Wl,--relax -mcall-prologues&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;compiler.cpp.extra_flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;-fno-tree-scev-cprop -fno-split-wide-types -Wl,--relax -mcall-prologues&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;compiler.c.elf.extra_flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;-Wl,--relax&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Not that you should, but you can even try more aggressive optimizations supposed to change a little the printer execution time for some routines:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nt&quot;&gt;-finline-limit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3 &lt;span class=&quot;nt&quot;&gt;-ffast-math&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Some of my sizes using PlatformIO when compiling Marlin 1.1.9 for my customized version of an Anet A8 with filament runout sensor, bed probe, graphical display, wifi and others:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Size (bytes)&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Options&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;125216&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Default flags&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;124240&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;-fno-tree-scev-cprop -fno-split-wide-types&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;123324&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;-fno-tree-scev-cprop -fno-split-wide-types -Wl,–relax&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;119730&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;-fno-tree-scev-cprop -fno-split-wide-types -Wl,–relax -mcall-prologues&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;118872&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;-fno-tree-scev-cprop -fno-split-wide-types -Wl,–relax -mcall-prologues -finline-limit=3 -ffast-math&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;You can verify what each of these options do in avr-gcc man page or online at &lt;a href=&quot;http://ccrma.stanford.edu/planetccrma/man/man1/avr-gcc.1.html&quot;&gt;avr-gcc manpage&lt;/a&gt;.&lt;/p&gt;</content><author><name></name></author><summary type="html">How to reduce the Marlin binary size? Here are my special compilation flags that was able to reduce it by almost 6K.</summary></entry><entry><title type="html">Welcome to Jekyll!</title><link href="http://localhost:4000/blog/jekyll/update/2019/01/07/welcome-to-jekyll.html" rel="alternate" type="text/html" title="Welcome to Jekyll!" /><published>2019-01-07T18:44:14-02:00</published><updated>2019-01-07T18:44:14-02:00</updated><id>http://localhost:4000/blog/jekyll/update/2019/01/07/welcome-to-jekyll</id><content type="html" xml:base="http://localhost:4000/blog/jekyll/update/2019/01/07/welcome-to-jekyll.html">&lt;p&gt;You’ll find this post in your &lt;code class=&quot;highlighter-rouge&quot;&gt;_posts&lt;/code&gt; directory. Go ahead and edit it and re-build the site to see your changes. You can rebuild the site in many different ways, but the most common way is to run &lt;code class=&quot;highlighter-rouge&quot;&gt;jekyll serve&lt;/code&gt;, which launches a web server and auto-regenerates your site when a file is updated.&lt;/p&gt;

&lt;p&gt;To add new posts, simply add a file in the &lt;code class=&quot;highlighter-rouge&quot;&gt;_posts&lt;/code&gt; directory that follows the convention &lt;code class=&quot;highlighter-rouge&quot;&gt;YYYY-MM-DD-name-of-post.ext&lt;/code&gt; and includes the necessary front matter. Take a look at the source for this post to get an idea about how it works.&lt;/p&gt;

&lt;p&gt;Jekyll also offers powerful support for code snippets:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;print_hi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Hi, &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;print_hi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Tom'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#=&amp;gt; prints 'Hi, Tom' to STDOUT.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Check out the &lt;a href=&quot;https://jekyllrb.com/docs/home&quot;&gt;Jekyll docs&lt;/a&gt; for more info on how to get the most out of Jekyll. File all bugs/feature requests at &lt;a href=&quot;https://github.com/jekyll/jekyll&quot;&gt;Jekyll’s GitHub repo&lt;/a&gt;. If you have questions, you can ask them on &lt;a href=&quot;https://talk.jekyllrb.com/&quot;&gt;Jekyll Talk&lt;/a&gt;.&lt;/p&gt;</content><author><name></name></author><summary type="html">You’ll find this post in your _posts directory. Go ahead and edit it and re-build the site to see your changes. You can rebuild the site in many different ways, but the most common way is to run jekyll serve, which launches a web server and auto-regenerates your site when a file is updated.</summary></entry></feed>