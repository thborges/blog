<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.5">Jekyll</generator><link href="http://localhost:4000/blog/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/blog/" rel="alternate" type="text/html" /><updated>2019-01-07T23:08:56-02:00</updated><id>http://localhost:4000/blog/feed.xml</id><title type="html">3D, circuits and coding projects</title><subtitle>Documentation for some profissional and hobbie projects about 3D printers modifications, 3D designs, algorithms, circuits and more. Thank you for reading. Fell free to contact me.</subtitle><entry><title type="html">Reducing Marlin firmware binary size to fit in your 3D printer board memory</title><link href="http://localhost:4000/blog/marlin/2019/01/07/reducing-marlin-binary-size.html" rel="alternate" type="text/html" title="Reducing Marlin firmware binary size to fit in your 3D printer board memory" /><published>2019-01-07T18:44:14-02:00</published><updated>2019-01-07T18:44:14-02:00</updated><id>http://localhost:4000/blog/marlin/2019/01/07/reducing-marlin-binary-size</id><content type="html" xml:base="http://localhost:4000/blog/marlin/2019/01/07/reducing-marlin-binary-size.html">&lt;p&gt;How to reduce the Marlin binary size? Here are my special compilation flags that was able to reduce it by almost 6K.&lt;/p&gt;

&lt;p&gt;Changing them is easy wether you are using Arduino IDE or PlataformIO.&lt;/p&gt;

&lt;p&gt;If already using PlataformIO, it is easier. Just create a new build target in platformio.ini, copying the original config for your printer board and adding the new flags:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ini&quot; data-lang=&quot;ini&quot;&gt;&lt;span class=&quot;py&quot;&gt;build_unflags&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;-g -ggdb&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;build_flags&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;${common.build_flags} -fno-tree-scev-cprop -fno-split-wide-types -Wl,--relax -mcall-prologues&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;In Arduino IDE, you should edit the file platform.local.txt for your board. It is inside the hardware folder, together with your other Arduino project folders, or in the Arduino instalation folder. Search for it.&lt;/p&gt;

&lt;p&gt;Content to add in platform.local.txt:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ini&quot; data-lang=&quot;ini&quot;&gt;&lt;span class=&quot;py&quot;&gt;compiler.c.extra_flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;-fno-tree-scev-cprop -fno-split-wide-types -Wl,--relax -mcall-prologues&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;compiler.cpp.extra_flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;-fno-tree-scev-cprop -fno-split-wide-types -Wl,--relax -mcall-prologues&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;compiler.c.elf.extra_flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;-Wl,--relax&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Not that you should, but you can even try more aggressive optimizations supposed to change a little the printer execution time for some routines:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nt&quot;&gt;-finline-limit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3 &lt;span class=&quot;nt&quot;&gt;-ffast-math&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Some of my sizes using PlatformIO when compiling Marlin 1.1.9 for my customized version of an Anet A8 with filament runout sensor, bed probe, graphical display, wifi and others:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Size (bytes)&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Options&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;125216&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Default flags&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;124240&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;-fno-tree-scev-cprop -fno-split-wide-types&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;123324&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;-fno-tree-scev-cprop -fno-split-wide-types -Wl,–relax&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;119730&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;-fno-tree-scev-cprop -fno-split-wide-types -Wl,–relax -mcall-prologues&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;118872&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;-fno-tree-scev-cprop -fno-split-wide-types -Wl,–relax -mcall-prologues -finline-limit=3 -ffast-math&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;You can verify what each of these options do in avr-gcc man page or online at &lt;a href=&quot;http://ccrma.stanford.edu/planetccrma/man/man1/avr-gcc.1.html&quot;&gt;avr-gcc manpage&lt;/a&gt;.&lt;/p&gt;</content><author><name></name></author><summary type="html">How to reduce the Marlin binary size? Here are my special compilation flags that was able to reduce it by almost 6K.</summary></entry></feed>